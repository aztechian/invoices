<!doctype html>
<html>
{% load static %}
  <head>
    <title>Detail - {{ invoice.pk }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <!-- base bootstrap -->
    <link rel="stylesheet" type="text/css" media="screen" href={% static 'css/bootstrap-theme.min.css' %}>
    <link rel="stylesheet" type="text/css" media="screen" href={% static 'css/bootstrap-responsive.min.css' %}>

    <!-- bootstrap x-editable -->
    <link rel="stylesheet" type="text/css" href={% static 'css/bootstrap-editable.css' %}>

    <link rel="stylesheet" type="text/css" href={% static 'css/invoice.css' %}>

    <script type="text/javascript" src={% static 'js/jquery-1.10.0.min.js' %}></script>
  </head>

<body>
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <a class="brand" href="#">imartin.net Invoicing</a>
        <div class="navbar-content">
          <ul class="nav">
            <li class="active">
              <a href="/invoice/">Home</a> 
            </li>
            <li>
              <a href="/invoice/">Invoices</a> 
            </li>
            <li>
              <a href="/customer/">Customers</a> 
            </li>
            <li>
              <a href="#">About</a> 
            </li>
            <li>
              <a href="#">Contact</a> 
            </li>
          </ul>
        </div>
        <form class="navbar-search pull-right" action="/invoice/search/" method="GET">
          {% csrf_token %}
          <input type="text" class="search-query" placeholder="Search..." name="q"> 
        </form>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span2">
        <ul class="nav  nav-pills nav-stacked">
          <li class="active">
            <a href="#">Invoices</a> 
          </li>
          <li>
            <a href="#">Customers</a> 
          </li>
        </ul>
        <div class="well">
          <p>
            <b>Tip:</b> You can add additional customers directly during invoice creation.</p>
          </div>
      </div>
      <header>
        <h3 class="status complete">Created</h3>
        <h3 class="status inprocess">Sent</h3>
        <h3 class="status inprocess">$Paid$</h3>
      </header>
      <div class="span10">
        <div class="invoice-body">
        <div class="row-fluid">
          <div class="pull-right invoice-id">Invoice #{{ invoice.pk }}</div>
        </div>
        <form id="lineitem-form">
          <div class="row-fluid">
            <div class="span3 sender address">
              <p>Mark
                <br> 123 Main St
                <br> Anytown, USA 12345</p>
            </div>
            <div class="span3 pull-right recipient address">
              <p>Customer1
                <br> Address1
                <br> Address2
                <br> City, State zip
                <br> 
              </p>
            </div>
          </div>
          <div class="row-fluid">
            <div class="span7 offset1 invoice-heading">Invoice header, status, etc</div>
          </div>
          <table id="lineitem-list" class="table">
            <thead>
              <tr>
                <th style="width: 5%">&nbsp;</th>
                <th style="width: 50%">Description</th>
                <th style="width: 5%">Qty.</th>
                <th style="width: 13%">Unit Price</th>
                <th style="width: 5%">Taxable</th>
                <th style="width: 12%">Total Price</th>
              </tr>
            </thead>
            <tbody>
              {% for li in invoice.lineitem_set.all %}
              <tr id={{ li.pk }}>
                <td>{{ forloop.counter }}</td>
                <td><a href="#" data-type="text" data-title="Description">{{ li.description }}</a></td>
                <td><a href="#" data-type="text" data-title="Quantity">{{ li.quantity }}</a></td>
                <td><a href="#" data-type="text" data-title="Unit Price" class="currency">{{ li.unit_price }}</a></td>
                <td><input name="Taxable" type="checkbox" value="True" {% if li.taxable %}checked{% endif %}></input></td>
                <td id="total" class="currency">{{ li.total }}</td>
              </tr>
              {% endfor %}
              <tr id="lineitem-template" style="display: none;">
                <td></td>
                <td><a href="#" data-type="text" data-title="Description"></a></td>
                <td><a href="#" data-type="text" data-title="Quantity"></a></td>
                <td><a href="#" data-type="text" data-title="Unit Price" class="currency"></a></td>
                <td><input name="Taxable" type="checkbox" value="True" checked></input></td>
                <td id="total" class="currency">0.00</td>
              </tr>
            </tbody>
          </table>
        </form>
      <hr>
      <div class="totalbox">
        <p class="totalLabel">Sub Total: <span class="total currency">{{ invoice.sub_total }}</span></p>
        <p class="totalLabel">Tax: <span class="total currency">{{ invoice.total_tax }}</span> 
        </p>
        <p class="totalLabel">Grand Total: <span class="total currency">{{ invoice.grand_total }}</span> 
        </p>
      </div>
    </div>
    <button type="button" class="btn pull-right" style="margin: 4px;">Cancel</button>
    <button type="button" class="btn btn-success pull-right" style="margin: 4px;">Save</button>
    </div>
  </div>
  </div>
    <script type="text/javascript" src={% static 'js/bootstrap.min.js' %}></script>
    <script type="text/javascript" src={% static 'js/bootstrap-editable.min.js' %}></script>

    <script type="text/javascript">
    $.fn.editable.defaults.mode = 'inline';
    $().ready(function(){
      $("#lineitem-list a").editable();

      newrow = $("#lineitem-template").clone();
      $newrow = $(newrow);
      $newrow.attr('id', 'newlineitem').css('background', '#F7F7C8');
      currRowCount = $('#lineitem-list tbody')[0].rows.length;
      $newrow.children('td:first').html(currRowCount); //it already be +1 because of the template row
      $('#lineitem-list tbody').append(newrow);
      $(newrow).find('a').editable();
      $(newrow).show(1750, function(){
        $(newrow).filter('tr').css('background', '');
      });
    });

    // $("#lineitem-list a").on('save', function(e, params){
    //   alert("Saved value: " + params.newValue + "\n all params = " + JSON.stringify(params))
    //   lineitem_id = $(e.currentTarget).closest('tr').attr('id')
    //   if (lineitem_id === '')
    //     method = 'POST'
    //   else
    //     method = 'PUT'
    //   console.log("Calling " + method + " on line item " + lineitem_id)
    // })

    $('#lineitem-list .editable').on('hidden', function(e, reason){
        console.log("Editable hidden");
        if(reason === 'save' || reason === 'nochange') {
            var $next = $(this).closest('tr').next().find('.editable');
            setTimeout(function() {
                $next.editable('show');
            }, 300); 
        }
   });
    </script>

  </body>

</html>