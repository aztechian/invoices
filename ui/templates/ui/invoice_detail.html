{% extends "ui/base.html" %}
{% load staticfiles %}

{% block title-addendum %} - Invoices {% endblock title-addendum %}

{% block css %}
	{{block.super}}
	<link rel="stylesheet" href="{% static 'css/invoice.css' %}" type="text/css" />
{% endblock css %}

{% block header %}
<header>
	<h3 class="status complete">Created</h3>
	<h3 class="status inprocess">Sent</h3>
	<h3 class="status inprocess">$Paid$</h3>
</header>
{% endblock header %}

{% block main-content %}
<div class="invoice-body">
	<div class="row-fluid">
		<div class="pull-right invoice-id">Invoice #{{ invoice.pk }}</div>
	</div>
	<form id="lineitem-form">
		<div class="row-fluid">
			<div class="span3 sender address">
				<p>Mark
					<br>123 Main St
					<br>Anytown, USA 12345</p>
			</div>
			<div class="span3 pull-right recipient address">
				<p>Customer1
					<br>Address1
					<br>Address2
					<br>City, State zip
					<br>
				</p>
			</div>
		</div>
		<div class="row-fluid">
			<div class="span7 offset1 invoice-heading">Invoice header, status, etc</div>
		</div>
		<table id="lineitem-list" class="table">
			<thead>
				<tr>
					<th style="width: 5%">&nbsp;</th>
					<th style="width: 50%">Description</th>
					<th style="width: 5%">Qty.</th>
					<th style="width: 13%">Unit Price</th>
					<th style="width: 5%">Taxable</th>
					<th style="width: 12%">Total Price</th>
				</tr>
			</thead>
			<tbody>
				{% for li in invoice.lineitem_set.all %}
				<tr id={{ li.pk }}>
					<td>{{ forloop.counter }}</td>
					<td><a href="#" data-type="text" data-title="Description">{{ li.description }}</a></td>
					<td><a href="#" data-type="text" data-title="Quantity">{{ li.quantity }}</a></td>
					<td><a href="#" data-type="text" data-title="Unit Price" class="currency">{{ li.unit_price }}</a></td>
					<td><input name="Taxable" type="checkbox" value="True" {% if li.taxable %}checked{% endif %}></input></td>
					<td id="total" class="currency">{{ li.total }}</td>
				</tr>
				{% endfor %}
            </tbody>
          </table>
        </form>
      <hr>
      <div class="totalbox">
        <p class="totalLabel">Sub Total: <span class="total currency">{{ invoice.sub_total }}</span></p>
        <p class="totalLabel">Tax: <span class="total currency">{{ invoice.total_tax }}</span> 
        </p>
        <p class="totalLabel">Grand Total: <span class="total currency">{{ invoice.grand_total }}</span> 
        </p>
      </div>
    </div>
    <button type="button" class="btn pull-right" style="margin: 4px;">Cancel</button>
    <button type="button" class="btn btn-success pull-right" style="margin: 4px;">Save</button>
{% endblock main-content %}

{% block javascript %}
	{{ block.super }}
<script type="text/javascript">
	$.fn.editable.defaults.mode = 'inline';
	$.fn.editable.defaults.showbuttons = false;
	$('#nav_invoices').addClass('active');
	
	$().ready(function() {
		$("#lineitem-list a").editable();

		var newrow = $(document.getElementById("templates").innerHTML);
		var $newrow = newrow.clone();
		$newrow.attr('id', 'newlineitem').css('background', '#FAFAE6');
		var currRowCount = $('#lineitem-list tbody')[0].rows.length;
		$newrow.children('td:first').html(currRowCount); //it already be +1 because of the template row
		$('#lineitem-list tbody').append($newrow);
		$newrow.find('a').editable();
		$newrow.show('slow', function() {
			$newrow.css('background', '');
		});

		// $('.recipient').editable({
		//   value: {
		//     full_name: 'Customer One',
		//     address1: '1234 Main St',
		//     address2: '',
		//     city: 'Anytown',
		//     state: 'NE',
		//     zip: '62932'
		//   },
		//   validate: function(value){
		//     if( value.address1 === '' )
		//       return 'Address is required';
		//     if( value.city === '' )
		//       return 'City is required';
		//     if( value.state === '' )
		//       return 'State is required';
		//     if( value.zip === '' )
		//       return 'Zip code is required';
		//     if( ! /(^\d{5}$)|(^\d{5}-\d{4}$)/.test(value.zip) )
		//       return 'Zip code in invalid format';
		//   },
		//   display: function(value){
		//     if( !value ){
		//       $(this).empty();
		//       return;
		//     }
		//     var thehtml = '<p>' + value.full_name + "<br>" + value.address1 + "<br>" + value.address2 + "<br>" + value.city + ", " + value.state + " " + value.zip + "</p>";
		//     $(this).html(thehtml);
		//   }
		// });
		// });
	});

	$(document).on('hidden', '#lineitem-list a', function(e, reason) {
		console.log("Editable hidden");
		if (reason === 'save' || reason === 'nochange') {
			var $next = $(this).closest('tr').next().find('.editable');
			setTimeout(function() {
				$next.editable('show');
			}, 300);
		}
	});
	
	
</script>
{% endblock javascript %}

{% block hidden-html %}
<tr id="lineitem-template" style="display: none;">
	<td></td>
	<td>
		<a href="#" data-type="text" data-title="Description"></a>
	</td>
	<td>
		<a href="#" data-type="text" data-title="Quantity"></a>
	</td>
	<td>
		<a href="#" data-type="text" data-title="Unit Price" class="currency"></a>
	</td>
	<td>
		<input name="Taxable" type="checkbox" value="True" checked></input>
	</td>
	<td id="total" class="currency">0.00</td>
</tr>
{% endblock hidden-html %}